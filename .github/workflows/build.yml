name: Server CI/CD

on:
  push:
    branches:
      - 'RTRE20-75-skapa-en-fungerande-chatt-system2'

env:
  SERVICE_ACCOUNT_KEY: ${{ secrets.SERVICE_ACCOUNT_KEY }}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - name: Clone Repo
        uses: actions/checkout@v2
      - name: Write Secrets
        run: |
          touch ./serviceAccountKey.json
          echo $SERVICE_ACCOUNT_KEY >> ./serviceAccountKey.json
          cat ./serviceAccountKey.json
          echo ./serviceAccountKey.json
        shell: bash
        env:
          SERVICE_ACCOUNT_KEY: ${{ secrets.SERVICE_ACCOUNT_KEY }}
      - name:  Upload Artifact
        uses: actions/upload-artifact@v2
        with:
          name: SERVICE_ACCOUNT_KEY
          path: ./serviceAccountKey.json
      - name: Build Maven
        run: |
          cd server
          mvn install 
          mvn -B clean package 
          mvn spring-boot:run
